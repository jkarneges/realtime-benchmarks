/* Syncano_SockJS client, version --minify, http://sockjs.org, MIT License

Copyright (c) 2011-2012 VMware, Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/

// JSON2 by Douglas Crockford (minified).
var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}()

Syncano_SockJS=function(){var a=document,b=window,c={},d=function(){};d.prototype.addEventListener=function(a,b){this._listeners||(this._listeners={}),a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];c.arrIndexOf(d,b)===-1&&d.push(b);return},d.prototype.removeEventListener=function(a,b){if(!(this._listeners&&a in this._listeners))return;var d=this._listeners[a],e=c.arrIndexOf(d,b);if(e!==-1){d.length>1?this._listeners[a]=d.slice(0,e).concat(d.slice(e+1)):delete this._listeners[a];return}return},d.prototype.dispatchEvent=function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);this["on"+b]&&this["on"+b].apply(this,c);if(this._listeners&&b in this._listeners)for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].apply(this,c)};var e=function(a,b){this.type=a;if(typeof b!="undefined")for(var c in b){if(!b.hasOwnProperty(c))continue;this[c]=b[c]}};e.prototype.toString=function(){var a=[];for(var b in this){if(!this.hasOwnProperty(b))continue;var c=this[b];typeof c=="function"&&(c="[function]"),a.push(b+"="+c)}return"SimpleEvent("+a.join(", ")+")"};var f=function(a){var b=this;b._events=a||[],b._listeners={}};f.prototype.emit=function(a){var b=this;b._verifyType(a);if(b._nuked)return;var c=Array.prototype.slice.call(arguments,1);b["on"+a]&&b["on"+a].apply(b,c);if(a in b._listeners)for(var d=0;d<b._listeners[a].length;d++)b._listeners[a][d].apply(b,c)},f.prototype.on=function(a,b){var c=this;c._verifyType(a);if(c._nuked)return;a in c._listeners||(c._listeners[a]=[]),c._listeners[a].push(b)},f.prototype._verifyType=function(a){var b=this;c.arrIndexOf(b._events,a)===-1&&c.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(b._events)+" in "+b)},f.prototype.nuke=function(){var a=this;a._nuked=!0;for(var b=0;b<a._events.length;b++)delete a[a._events[b]];a._listeners={}};var g="abcdefghijklmnopqrstuvwxyz0123456789_";c.random_string=function(a,b){b=b||g.length;var c,d=[];for(c=0;c<a;c++)d.push(g.substr(Math.floor(Math.random()*b),1));return d.join("")},c.random_number=function(a){return Math.floor(Math.random()*a)},c.random_number_string=function(a){var b=(""+(a-1)).length,d=Array(b+1).join("0");return(d+c.random_number(a)).slice(-b)},c.getOrigin=function(a){a+="/";var b=a.split("/").slice(0,3);return b.join("/")},c.isSameOriginUrl=function(a,c){return c||(c=b.location.href),a.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")},c.getParentDomain=function(a){if(/^[0-9.]*$/.test(a))return a;if(/^\[/.test(a))return a;if(!/[.]/.test(a))return a;var b=a.split(".").slice(1);return b.join(".")},c.objectExtend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};var h="_jp";c.polluteGlobalNamespace=function(){h in b||(b[h]={})},c.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])},c.userSetCode=function(a){return a===1e3||a>=3e3&&a<=4999},c.countRTO=function(a){var b;return a>100?b=3*a:b=a+200,b},c.log=function(){b.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},c.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},c.flatUrl=function(a){return a.indexOf("?")===-1&&a.indexOf("#")===-1},c.amendUrl=function(b){var d=a.location;if(!b)throw new Error("Wrong url for Syncano_SockJS");if(!c.flatUrl(b))throw new Error("Only basic urls are supported in Syncano_SockJS");return b.indexOf("//")===0&&(b=d.protocol+b),b.indexOf("/")===0&&(b=d.protocol+"//"+d.host+b),b=b.replace(/[/]+$/,""),b},c.arrIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},c.arrSkip=function(a,b){var d=c.arrIndexOf(a,b);if(d===-1)return a.slice();var e=a.slice(0,d);return e.concat(a.slice(d+1))},c.isArray=Array.isArray||function(a){return{}.toString.call(a).indexOf("Array")>=0},c.delay=function(a,b){return typeof a=="function"&&(b=a,a=0),setTimeout(b,a)};var i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j={"\0":"\\u0000","\x01":"\\u0001","\x02":"\\u0002","\x03":"\\u0003","\x04":"\\u0004","\x05":"\\u0005","\x06":"\\u0006","\x07":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\x0b":"\\u000b","\f":"\\f","\r":"\\r","\x0e":"\\u000e","\x0f":"\\u000f","\x10":"\\u0010","\x11":"\\u0011","\x12":"\\u0012","\x13":"\\u0013","\x14":"\\u0014","\x15":"\\u0015","\x16":"\\u0016","\x17":"\\u0017","\x18":"\\u0018","\x19":"\\u0019","\x1a":"\\u001a","\x1b":"\\u001b","\x1c":"\\u001c","\x1d":"\\u001d","\x1e":"\\u001e","\x1f":"\\u001f",'"':'\\"',"\\":"\\\\","\x7f":"\\u007f","\x80":"\\u0080","\x81":"\\u0081","\x82":"\\u0082","\x83":"\\u0083","\x84":"\\u0084","\x85":"\\u0085","\x86":"\\u0086","\x87":"\\u0087","\x88":"\\u0088","\x89":"\\u0089","\x8a":"\\u008a","\x8b":"\\u008b","\x8c":"\\u008c","\x8d":"\\u008d","\x8e":"\\u008e","\x8f":"\\u008f","\x90":"\\u0090","\x91":"\\u0091","\x92":"\\u0092","\x93":"\\u0093","\x94":"\\u0094","\x95":"\\u0095","\x96":"\\u0096","\x97":"\\u0097","\x98":"\\u0098","\x99":"\\u0099","\x9a":"\\u009a","\x9b":"\\u009b","\x9c":"\\u009c","\x9d":"\\u009d","\x9e":"\\u009e","\x9f":"\\u009f","\xad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063","\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd","\ufffe":"\\ufffe","\uffff":"\\uffff"},k=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,l,m=JSON&&JSON.stringify||function(a){return i.lastIndex=0,i.test(a)&&(a=a.replace(i,function(a){return j[a]})),'"'+a+'"'},n=function(a){var b,c={},d=[];for(b=0;b<65536;b++)d.push(String.fromCharCode(b));return a.lastIndex=0,d.join("").replace(a,function(a){return c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,c};c.quote=function(a){var b=m(a);return k.lastIndex=0,k.test(b)?(l||(l=n(k)),b.replace(k,function(a){return l[a]})):b};var o=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];c.probeProtocols=function(){var a={};for(var b=0;b<o.length;b++){var c=o[b];a[c]=y[c]&&y[c].enabled()}return a},c.detectProtocols=function(a,b,c){var d={},e=[];b||(b=o);for(var f=0;f<b.length;f++){var g=b[f];d[g]=a[g]}var h=function(a){var b=a.shift();d[b]?e.push(b):a.length>0&&h(a)};return c.websocket!==!1&&h(["websocket"]),d["xhr-streaming"]&&!c.null_origin?e.push("xhr-streaming"):d["xdr-streaming"]&&!c.cookie_needed&&!c.null_origin?e.push("xdr-streaming"):h(["iframe-eventsource","iframe-htmlfile"]),d["xhr-polling"]&&!c.null_origin?e.push("xhr-polling"):d["xdr-polling"]&&!c.cookie_needed&&!c.null_origin?e.push("xdr-polling"):h(["iframe-xhr-polling","jsonp-polling"]),e};var p="_sockjs_global";c.createHook=function(){var a="a"+c.random_string(8);if(!(p in b)){var d={};b[p]=function(a){return a in d||(d[a]={id:a,del:function(){delete d[a]}}),d[a]}}return b[p](a)},c.attachMessage=function(a){c.attachEvent("message",a)},c.attachEvent=function(c,d){typeof b.addEventListener!="undefined"?b.addEventListener(c,d,!1):(a.attachEvent("on"+c,d),b.attachEvent("on"+c,d))},c.detachMessage=function(a){c.detachEvent("message",a)},c.detachEvent=function(c,d){typeof b.addEventListener!="undefined"?b.removeEventListener(c,d,!1):(a.detachEvent("on"+c,d),b.detachEvent("on"+c,d))};var q={},r=!1,s=function(){for(var a in q)q[a](),delete q[a]},t=function(){if(r)return;r=!0,s()};c.attachEvent("unload",t),c.unload_add=function(a){var b=c.random_string(8);return q[b]=a,r&&c.delay(s),b},c.unload_del=function(a){a in q&&delete q[a]},c.createIframe=function(b,d){var e=a.createElement("iframe"),f,g,h=function(){clearTimeout(f);try{e.onload=null}catch(a){}e.onerror=null},i=function(){e&&(h(),setTimeout(function(){e&&e.parentNode.removeChild(e),e=null},0),c.unload_del(g))},j=function(a){e&&(i(),d(a))},k=function(a,b){try{e&&e.contentWindow&&e.contentWindow.postMessage(a,b)}catch(c){}};return e.src=b,e.style.display="none",e.style.position="absolute",e.onerror=function(){j("onerror")},e.onload=function(){clearTimeout(f),f=setTimeout(function(){j("onload timeout")},2e3)},a.body.appendChild(e),f=setTimeout(function(){j("timeout")},15e3),g=c.unload_add(i),{post:k,cleanup:i,loaded:h}},c.createHtmlfile=function(a,d){var e=new ActiveXObject("htmlfile"),f,g,i,j=function(){clearTimeout(f)},k=function(){e&&(j(),c.unload_del(g),i.parentNode.removeChild(i),i=e=null,CollectGarbage())},l=function(a){e&&(k(),d(a))},m=function(a,b){try{i&&i.contentWindow&&i.contentWindow.postMessage(a,b)}catch(c){}};e.open(),e.write('<html><script>document.domain="'+document.domain+'";'+"</s"+"cript></html>"),e.close(),e.parentWindow[h]=b[h];var n=e.createElement("div");return e.body.appendChild(n),i=e.createElement("iframe"),n.appendChild(i),i.src=a,f=setTimeout(function(){l("timeout")},15e3),g=c.unload_add(k),{post:m,cleanup:k,loaded:j}};var u=function(){};u.prototype=new f(["chunk","finish"]),u.prototype._start=function(a,d,e,f){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new b.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}if(b.ActiveXObject||b.XDomainRequest)d+=(d.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);g.unload_ref=c.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(a,d,!0)}catch(i){g.emit("finish",0,""),g._cleanup();return}if(!f||!f.no_credentials)g.xhr.withCredentials="true";if(f&&f.headers)for(var j in f.headers)g.xhr.setRequestHeader(j,f.headers[j]);g.xhr.onreadystatechange=function(){if(g.xhr){var a=g.xhr;switch(a.readyState){case 3:try{var b=a.status,c=a.responseText}catch(a){}b===1223&&(b=204),c&&c.length>0&&g.emit("chunk",b,c);break;case 4:var b=a.status;b===1223&&(b=204),g.emit("finish",b,a.responseText),g._cleanup(!1)}}},g.xhr.send(e)},u.prototype._cleanup=function(a){var b=this;if(!b.xhr)return;c.unload_del(b.unload_ref),b.xhr.onreadystatechange=function(){};if(a)try{b.xhr.abort()}catch(d){}b.unload_ref=b.xhr=null},u.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)};var v=c.XHRCorsObject=function(){var a=this,b=arguments;c.delay(function(){a._start.apply(a,b)})};v.prototype=new u;var w=c.XHRLocalObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d,{no_credentials:!0})})};w.prototype=new u;var x=c.XDRObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};x.prototype=new f(["chunk","finish"]),x.prototype._start=function(a,b,d){var e=this,f=new XDomainRequest;b+=(b.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);var g=f.ontimeout=f.onerror=function(){e.emit("finish",0,""),e._cleanup(!1)};f.onprogress=function(){e.emit("chunk",200,f.responseText)},f.onload=function(){e.emit("finish",200,f.responseText),e._cleanup(!1)},e.xdr=f,e.unload_ref=c.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(d)}catch(h){g()}},x.prototype._cleanup=function(a){var b=this;if(!b.xdr)return;c.unload_del(b.unload_ref),b.xdr.ontimeout=b.xdr.onerror=b.xdr.onprogress=b.xdr.onload=null;if(a)try{b.xdr.abort()}catch(d){}b.unload_ref=b.xdr=null},x.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)},c.isXHRCorsCapable=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:b.XDomainRequest&&a.domain?2:L.enabled()?3:4};var y=function(a,d,e){if(this===b)return new y(a,d,e);var f=this,g;f._options={devel:!1,debug:!1,protocols_whitelist:[],info:undefined,rtt:undefined},e&&c.objectExtend(f._options,e),f._base_url=c.amendUrl(a),f._server=f._options.server||c.random_number_string(1e3),f._options.protocols_whitelist&&f._options.protocols_whitelist.length?g=f._options.protocols_whitelist:(typeof d=="string"&&d.length>0?g=[d]:c.isArray(d)?g=d:g=null,g&&f._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to Syncano_SockJS constructor.')),f._protocols=[],f.protocol=null,f.readyState=y.CONNECTING,f._ir=S(f._base_url),f._ir.onfinish=function(a,b){f._ir=null,a?(f._options.info&&(a=c.objectExtend(a,f._options.info)),f._options.rtt&&(b=f._options.rtt),f._applyInfo(a,b,g),f._didClose()):f._didClose(1002,"Can't connect to server",!0)}};y.prototype=new d,y.version="--minify",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)},y.prototype._dispatchOpen=function(){var a=this;a.readyState===y.CONNECTING?(a._transport_tref&&(clearTimeout(a._transport_tref),a._transport_tref=null),a.readyState=y.OPEN,a.dispatchEvent(new e("open"))):a._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(a){var b=this;if(b.readyState!==y.OPEN)return;b.dispatchEvent(new e("message",{data:a}))},y.prototype._dispatchHeartbeat=function(a){var b=this;if(b.readyState!==y.OPEN)return;b.dispatchEvent(new e("heartbeat",{}))},y.prototype._didClose=function(a,b,d){var f=this;if(f.readyState!==y.CONNECTING&&f.readyState!==y.OPEN&&f.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");f._ir&&(f._ir.nuke(),f._ir=null),f._transport&&(f._transport.doCleanup(),f._transport=null);var g=new e("close",{code:a,reason:b,wasClean:c.userSetCode(a)});if(!c.userSetCode(a)&&f.readyState===y.CONNECTING&&!d){if(f._try_next_protocol(g))return;g=new e("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:g})}f.readyState=y.CLOSED,c.delay(function(){f.dispatchEvent(g)})},y.prototype._didMessage=function(a){var b=this,c=a.slice(0,1);switch(c){case"o":b._dispatchOpen();break;case"a":var d=JSON.parse(a.slice(1)||"[]");for(var e=0;e<d.length;e++)b._dispatchMessage(d[e]);break;case"m":var d=JSON.parse(a.slice(1)||"null");b._dispatchMessage(d);break;case"c":var d=JSON.parse(a.slice(1)||"[]");b._didClose(d[0],d[1]);break;case"h":b._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(b){var d=this;d.protocol&&(d._debug("Closed transport:",d.protocol,""+b),d.protocol=null),d._transport_tref&&(clearTimeout(d._transport_tref),d._transport_tref=null);for(;;){var e=d.protocol=d._protocols.shift();if(!e)return!1;if(y[e]&&y[e].need_body===!0&&(!a.body||typeof a.readyState!="undefined"&&a.readyState!=="complete"))return d._protocols.unshift(e),d.protocol="waiting-for-load",c.attachEvent("load",function(){d._try_next_protocol()}),!0;if(!!y[e]&&!!y[e].enabled(d._options)){var f=y[e].roundTrips||1,g=(d._options.rto||0)*f||5e3;d._transport_tref=c.delay(g,function(){d.readyState===y.CONNECTING&&d._didClose(2007,"Transport timeouted")});var h=c.random_string(8),i=d._base_url+"/"+d._server+"/"+h;return d._debug("Opening transport:",e," url:"+i," RTO:"+d._options.rto),d._transport=new y[e](d,i,d._base_url),!0}d._debug("Skipping transport:",e)}},y.prototype.close=function(a,b){var d=this;if(a&&!c.userSetCode(a))throw new Error("INVALID_ACCESS_ERR");return d.readyState!==y.CONNECTING&&d.readyState!==y.OPEN?!1:(d.readyState=y.CLOSING,d._didClose(a||1e3,b||"Normal closure"),!0)},y.prototype.send=function(a){var b=this;if(b.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return b.readyState===y.OPEN&&b._transport.doSend(c.quote(""+a)),!0},y.prototype._applyInfo=function(b,d,e){var f=this;f._options.info=b,f._options.rtt=d,f._options.rto=c.countRTO(d),f._options.info.null_origin=!a.domain;var g=c.probeProtocols();f._protocols=c.detectProtocols(g,e,b)};var z=y.websocket=function(a,d){var e=this,f=d+"/websocket";f.slice(0,5)==="https"?f="wss"+f.slice(5):f="ws"+f.slice(4),e.ri=a,e.url=f;var g=b.WebSocket||b.MozWebSocket;e.ws=new g(e.url),e.ws.onmessage=function(a){e.ri._didMessage(a.data)},e.unload_ref=c.unload_add(function(){e.ws.close()}),e.ws.onclose=function(){e.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}};z.prototype.doSend=function(a){this.ws.send("["+a+"]")},z.prototype.doCleanup=function(){var a=this,b=a.ws;b&&(b.onmessage=b.onclose=null,b.close(),c.unload_del(a.unload_ref),a.unload_ref=a.ri=a.ws=null)},z.enabled=function(){return!!b.WebSocket||!!b.MozWebSocket},z.roundTrips=2;var A=function(){};A.prototype.send_constructor=function(a){var b=this;b.send_buffer=[],b.sender=a},A.prototype.doSend=function(a){var b=this;b.send_buffer.push(a),b.send_stop||b.send_schedule()},A.prototype.send_schedule_wait=function(){var a=this,b;a.send_stop=function(){a.send_stop=null,clearTimeout(b)},b=c.delay(25,function(){a.send_stop=null,a.send_schedule()})},A.prototype.send_schedule=function(){var a=this;if(a.send_buffer.length>0){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(b,c){a.send_stop=null,b===!1?a.ri._didClose(1006,"Sending error "+c):a.send_schedule_wait()}),a.send_buffer=[]}},A.prototype.send_destructor=function(){var a=this;a._send_stop&&a._send_stop(),a._send_stop=null};var B=function(b,d,e){var f=this;if(!("_send_form"in f)){var g=f._send_form=a.createElement("form"),h=f._send_area=a.createElement("textarea");h.name="d",g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",g.appendChild(h),a.body.appendChild(g)}var g=f._send_form,h=f._send_area,i="a"+c.random_string(8);g.target=i,g.action=b+"/jsonp_send?i="+i;var j;try{j=a.createElement('<iframe name="'+i+'">')}catch(k){j=a.createElement("iframe"),j.name=i}j.id=i,g.appendChild(j),j.style.display="none";try{h.value=d}catch(l){c.log("Your browser is seriously broken. Go home! "+l.message)}g.submit();var m=function(a){if(!j.onerror)return;j.onreadystatechange=j.onerror=j.onload=null,c.delay(500,function(){j.parentNode.removeChild(j),j=null}),h.value="",e(!0)};return j.onerror=j.onload=m,j.onreadystatechange=function(a){j.readyState=="complete"&&m()},m},C=function(a){return function(b,c,d){var e=new a("POST",b+"/xhr_send",c);return e.onfinish=function(a,b){d(a===200||a===204,"http status "+a)},function(a){d(!1,a)}}},D=function(b,d){var e,f=a.createElement("script"),g,h=function(a){g&&(g.parentNode.removeChild(g),g=null),f&&(clearTimeout(e),f.parentNode.removeChild(f),f.onreadystatechange=f.onerror=f.onload=f.onclick=null,f=null,d(a),d=null)},i=!1,j=null;f.id="a"+c.random_string(8),f.src=b,f.type="text/javascript",f.charset="UTF-8",f.onerror=function(a){j||(j=setTimeout(function(){i||h(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},f.onload=function(a){h(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},f.onreadystatechange=function(a){if(/loaded|closed/.test(f.readyState)){if(f&&f.htmlFor&&f.onclick){i=!0;try{f.onclick()}catch(b){}}f&&h(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if(typeof f.async=="undefined"&&a.attachEvent)if(!/opera/i.test(navigator.userAgent)){try{f.htmlFor=f.id,f.event="onclick"}catch(k){}f.async=!0}else g=a.createElement("script"),g.text="try{var a = document.getElementById('"+f.id+"'); if(a)a.onerror();}catch(x){};",f.async=g.async=!1;typeof f.async!="undefined"&&(f.async=!0),e=setTimeout(function(){h(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=a.getElementsByTagName("head")[0];return l.insertBefore(f,l.firstChild),g&&l.insertBefore(g,l.firstChild),h},E=y["jsonp-polling"]=function(a,b){c.polluteGlobalNamespace();var d=this;d.ri=a,d.trans_url=b,d.send_constructor(B),d._schedule_recv()};E.prototype=new A,E.prototype._schedule_recv=function(){var a=this,b=function(b){a._recv_stop=null,b&&(a._is_closing||a.ri._didMessage(b)),a._is_closing||a._schedule_recv()};a._recv_stop=F(a.trans_url+"/jsonp",D,b)},E.enabled=function(){return!0},E.need_body=!0,E.prototype.doCleanup=function(){var a=this;a._is_closing=!0,a._recv_stop&&a._recv_stop(),a.ri=a._recv_stop=null,a.send_destructor()};var F=function(a,d,e){var f="a"+c.random_string(6),g=a+"?c="+escape(h+"."+f),i=0,j=function(a){switch(i){case 0:delete b[h][f],e(a);break;case 1:e(a),i=2;break;case 2:delete b[h][f]}},k=d(g,j);b[h][f]=k;var l=function(){b[h][f]&&(i=1,b[h][f](c.closeFrame(1e3,"JSONP user aborted read")))};return l},G=function(){};G.prototype=new A,G.prototype.run=function(a,b,c,d,e){var f=this;f.ri=a,f.trans_url=b,f.send_constructor(C(e)),f.poll=new $(a,d,b+c,e)},G.prototype.doCleanup=function(){var a=this;a.poll&&(a.poll.abort(),a.poll=null)};var H=y["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",bd,c.XHRCorsObject)};H.prototype=new G,H.enabled=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},H.roundTrips=2,H.need_body=!0;var I=y["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",bd,c.XDRObject)};I.prototype=new G,I.enabled=function(){return!!b.XDomainRequest},I.roundTrips=2;var J=y["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XHRCorsObject)};J.prototype=new G,J.enabled=H.enabled,J.roundTrips=2;var K=y["xdr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XDRObject)};K.prototype=new G,K.enabled=I.enabled,K.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(a,b,d){var e=this;e.ri=a,e.origin=c.getOrigin(d),e.base_url=d,e.trans_url=b;var f=d+"/iframe.html";e.ri._options.devel&&(f+="?t="+ +(new Date)),e.window_id=c.random_string(8),f+="#"+e.window_id,e.iframeObj=c.createIframe(f,function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")}),e.onmessage_cb=c.bind(e.onmessage,e),c.attachMessage(e.onmessage_cb)},L.prototype.doCleanup=function(){var a=this;if(a.iframeObj){c.detachMessage(a.onmessage_cb);try{a.iframeObj.iframe.contentWindow&&a.postMessage("c")}catch(b){}a.iframeObj.cleanup(),a.iframeObj=null,a.onmessage_cb=a.iframeObj=null}},L.prototype.onmessage=function(a){var b=this;if(a.origin!==b.origin)return;var c=a.data.slice(0,8),d=a.data.slice(8,9),e=a.data.slice(9);if(c!==b.window_id)return;switch(d){case"s":b.iframeObj.loaded(),b.postMessage("s",JSON.stringify([y.version,b.protocol,b.trans_url,b.base_url]));break;case"t":b.ri._didMessage(e)}},L.prototype.postMessage=function(a,b){var c=this;c.iframeObj.post(c.window_id+a+(b||""),c.origin)},L.prototype.doSend=function(a){this.postMessage("m",a)},L.enabled=function(){var a=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof b.postMessage=="function"||typeof b.postMessage=="object")&&!a};var M,N=function(a,d){parent!==b?parent.postMessage(M+a+(d||""),"*"):c.log("Can't postMessage, no parent window.",a,d)},O=function(){};O.prototype._didClose=function(a,b){N("t",c.closeFrame(a,b))},O.prototype._didMessage=function(a){N("t",a)},O.prototype._doSend=function(a){this._transport.doSend(a)},O.prototype._doCleanup=function(){this._transport.doCleanup()},c.parent_origin=undefined,y.bootstrap_iframe=function(){var d;M=a.location.hash.slice(1);var e=function(a){if(a.source!==parent)return;typeof c.parent_origin=="undefined"&&(c.parent_origin=a.origin);if(a.origin!==c.parent_origin)return;var e=a.data.slice(0,8),f=a.data.slice(8,9),g=a.data.slice(9);if(e!==M)return;switch(f){case"s":var h=JSON.parse(g),i=h[0],j=h[1],k=h[2],l=h[3];i!==y.version&&c.log('Incompatibile Syncano_SockJS! Main site uses: "'+i+'", the iframe:'+' "'+y.version+'".');if(!c.flatUrl(k)||!c.flatUrl(l)){c.log("Only basic urls are supported in Syncano_SockJS");return}if(!c.isSameOriginUrl(k)||!c.isSameOriginUrl(l)){c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([b.location.href,k,l])+")");return}d=new O,d._transport=new O[j](d,k,l);break;case"m":d._doSend(g);break;case"c":d&&d._doCleanup(),d=null}};c.attachMessage(e),N("s")};var P=function(a,b){var d=this;c.delay(function(){d.doXhr(a,b)})};P.prototype=new f(["finish"]),P.prototype.doXhr=function(a,b){var d=this,e=(new Date).getTime(),f=new b("GET",a+"/info"),g=c.delay(8e3,function(){f.ontimeout()});f.onfinish=function(a,b){clearTimeout(g),g=null;if(a===200){var c=(new Date).getTime()-e,f=JSON.parse(b);typeof f!="object"&&(f={}),d.emit("finish",f,c)}else d.emit("finish")},f.ontimeout=function(){f.close(),d.emit("finish")}};var Q=function(b){var d=this,e=function(){var a=new L;a.protocol="w-iframe-info-receiver";var c=function(b){if(typeof b=="string"&&b.substr(0,1)==="m"){var c=JSON.parse(b.substr(1)),e=c[0],f=c[1];d.emit("finish",e,f)}else d.emit("finish");a.doCleanup(),a=null},e={_options:{},_didClose:c,_didMessage:c};a.i_constructor(e,b,b)};a.body?e():c.attachEvent("load",e)};Q.prototype=new f(["finish"]);var R=function(){var a=this;c.delay(function(){a.emit("finish",{},2e3)})};R.prototype=new f(["finish"]);var S=function(a){if(c.isSameOriginUrl(a))return new P(a,c.XHRLocalObject);switch(c.isXHRCorsCapable()){case 1:return new P(a,c.XHRLocalObject);case 2:return new P(a,c.XDRObject);case 3:return new Q(a);default:return new R}},T=O["w-iframe-info-receiver"]=function(a,b,d){var e=new P(d,c.XHRLocalObject);e.onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c])),a._didClose()}};T.prototype.doCleanup=function(){};var U=y["iframe-eventsource"]=function(){var a=this;a.protocol="w-iframe-eventsource",a.i_constructor.apply(a,arguments)};U.prototype=new L,U.enabled=function(){return"EventSource"in b&&L.enabled()},U.need_body=!0,U.roundTrips=3;var V=O["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",_,c.XHRLocalObject)};V.prototype=new G;var W=y["iframe-xhr-polling"]=function(){var a=this;a.protocol="w-iframe-xhr-polling",a.i_constructor.apply(a,arguments)};W.prototype=new L,W.enabled=function(){return b.XMLHttpRequest&&L.enabled()},W.need_body=!0,W.roundTrips=3;var X=O["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XHRLocalObject)};X.prototype=new G;var Y=y["iframe-htmlfile"]=function(){var a=this;a.protocol="w-iframe-htmlfile",a.i_constructor.apply(a,arguments)};Y.prototype=new L,Y.enabled=function(){return L.enabled()},Y.need_body=!0,Y.roundTrips=3;var Z=O["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",bc,c.XHRLocalObject)};Z.prototype=new G;var $=function(a,b,c,d){var e=this;e.ri=a,e.Receiver=b,e.recv_url=c,e.AjaxObject=d,e._scheduleRecv()};$.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject),c=0;b.onmessage=function(b){c+=1,a.ri._didMessage(b.data)},b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=null,a.poll_is_closing||(c.reason==="permanent"?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}},$.prototype.abort=function(){var a=this;a.poll_is_closing=!0,a.poll&&a.poll.abort()};var _=function(a){var b=this,d=new EventSource(a);d.onmessage=function(a){b.dispatchEvent(new e("message",{data:unescape(a.data)}))},b.es_close=d.onerror=function(a,f){var g=f?"user":d.readyState!==2?"network":"permanent";b.es_close=d.onmessage=d.onerror=null,d.close(),d=null,c.delay(200,function(){b.dispatchEvent(new e("close",{reason:g}))})}};_.prototype=new d,_.prototype.abort=function(){var a=this;a.es_close&&a.es_close({},!0)};var ba,bb=function(){if(ba===undefined)if("ActiveXObject"in b)try{ba=!!(new ActiveXObject("htmlfile"))}catch(a){}else ba=!1;return ba},bc=function(a){var d=this;c.polluteGlobalNamespace(),d.id="a"+c.random_string(6,26),a+=(a.indexOf("?")===-1?"?":"&")+"c="+escape(h+"."+d.id);var f=bb()?c.createHtmlfile:c.createIframe,g;b[h][d.id]={start:function(){g.loaded()},message:function(a){d.dispatchEvent(new e("message",{data:a}))},stop:function(){d.iframe_close({},"network")}},d.iframe_close=function(a,c){g.cleanup(),d.iframe_close=g=null,delete b[h][d.id],d.dispatchEvent(new e("close",{reason:c}))},g=f(a,function(a){d.iframe_close({},"permanent")})};bc.prototype=new d,bc.prototype.abort=function(){var a=this;a.iframe_close&&a.iframe_close({},"user")};var bd=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null),c.xo.onchunk=function(a,b){if(a!==200)return;for(;;){var f=b.slice(d),g=f.indexOf("\n");if(g===-1)break;d+=g+1;var h=f.slice(0,g);c.dispatchEvent(new e("message",{data:h}))}},c.xo.onfinish=function(a,b){c.xo.onchunk(a,b),c.xo=null;var d=a===200?"network":"permanent";c.dispatchEvent(new e("close",{reason:d}))}};return bd.prototype=new d,bd.prototype.abort=function(){var a=this;a.xo&&(a.xo.close(),a.dispatchEvent(new e("close",{reason:"user"})),a.xo=null)},y.getUtils=function(){return c},y.getIframeTransport=function(){return L},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),typeof define=="function"&&define.amd&&define("sockjs",[],function(){return Syncano_SockJS});
/*
syncano
ver: 3.1.3beta
build date: 04-08-2014
Copyright 2014 Syncano Inc.
*/
!function(a,b){"use strict";function c(a){var b={},c="Boolean Number String Function Array Date RegExp Object".split(" ");for(var d in c)b["[object "+c[d]+"]"]=c[d].toLowerCase();return null===a?String(a):b[Object.prototype.toString.call(a)]||"object"}function d(a){return"function"===c(a)}function e(a){return null!==a&&a===a.window}function f(a){var d=Object.prototype.hasOwnProperty;if(!a||"object"!==c(a)||a.nodeType||e(a))return!1;try{if(a.constructor&&!d.call(a,"constructor")&&!d.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(f){return!1}var g;for(g in a);return g===b||d.call(a,g)}function g(a){return"array"===c(a)}function h(){var a,c,e,i,j,k,l=arguments[0]||{},m=1,n=arguments.length,o=!1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},m=2),"object"==typeof l||d(l)||(l={});n>m;m++)if(null!==(a=arguments[m]))for(c in a)e=l[c],i=a[c],l!==i&&(o&&i&&(f(i)||(j=g(i)))?(j?(j=!1,k=e&&g(e)?e:[]):k=e&&f(e)?e:{},l[c]=h(o,k,i)):i!==b&&(l[c]=i));return l}function i(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];a.charCodeAt(c)>=97?b.push(e):(b.push("_"),b.push(e.toLowerCase()))}return b.join("")}function j(a){return"undefined"!=typeof a&&null!==a}function k(a){return"number"==typeof a||parseInt(a,10)===a?!0:!1}function l(a){var b=new Date(a);return"[object Date]"!==Object.prototype.toString.call(b)?!1:!isNaN(b.getTime())}function m(a,b){return-1!==b.indexOf(a)?!0:!1}function n(a){return"boolean"==typeof a}var o={},p={},q=0;o.on=function(a,b){if("function"!=typeof b)return!1;p.hasOwnProperty(a)||(p[a]={});var c="uid_"+ ++q;return p[a][c]=b,c},o.once=function(a,b){if("function"!=typeof b)return!1;p.hasOwnProperty(a)||(p[a]={});var c="uid_"+ ++q;return p[a][c]=function(d){delete p[a][c],b(d)},c},o.hasSubscribers=function(a){return"string"!=typeof a?!1:p.hasOwnProperty(a)&&Object.keys(p[a]).length?!0:!1},o.off=function(a,b){if("all"===a&&(p={}),!this.hasSubscribers(a))return!1;if("undefined"==typeof b)return delete p[a];var c=p[a];for(var d in c)if(c.hasOwnProperty(d)&&b===c[d])return delete p[a][d];return!1},o.trigger=function(a){return o.doTrigger(a,!1,Array.prototype.slice.call(arguments,1))},o.triggerSync=function(a){return o.doTrigger(a,!0,Array.prototype.slice.call(arguments,1))},o.doTrigger=function(a,b){var c,d,e,f=!1,g=Array.prototype.slice.call(arguments,2)[0];if(this.hasSubscribers(a)){c=p[a];for(d in c)c.hasOwnProperty(d)&&(e=c[d],b===!1?setTimeout(e.call(e,g),0):e.call(e,g),f=!0)}var h="all";if(this.hasSubscribers(h)){c=p[h];for(d in c)c.hasOwnProperty(d)&&(e=c[d],b===!1?setTimeout(e.call(e,a,g),0):e.call(e,a,g),f=!0)}return f};var r={};r.new=function(a,b,c){var d="project.new";if(!j(a))throw new Error(d+": name must be defined");var e={name:a};j(b)&&(e.description=b),this.__super__.__sendWithCallback(d,e,"project",c)},r.get=function(a){var b="project.get";this.__super__.__sendWithCallback(b,{},"project",a)},r.getOne=function(a,b){this.__super__.__checkProjectId(a);var c="project.get_one";this.__super__.__sendWithCallback(c,{project_id:a},"project",b)},r.update=function(a,b,c,d){if(this.__super__.__checkProjectId(a),!("undefined"!=typeof b&&null!==b||"undefined"!=typeof c&&null!==b))return!1;var e="project.update",f={project_id:a};b&&(f.name=b),"undefined"!=typeof c&&null!==c&&(f.description=c),this.__super__.__sendWithCallback(e,f,"project",d)},r.delete=function(a,b){this.__super__.__checkProjectId(a);var c="project.delete";this.__super__.__sendWithCallback(c,{project_id:a},null,b)};var s={};s.new=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.new";if(!j(b))throw new Error(e+": name must be set");var f={name:b,project_id:a};j(c)&&(j(c.description)&&(f.description=c.description),j(c.key)&&(f.key=c.key)),this.__super__.__sendWithCallback(e,f,"collection",d)},s.get=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.get",e={project_id:a};if(j(b)){if(j(b.status)){if(!m(b.status.toLowerCase(),["all","active","inactive"]))throw new Error(d+': status must be one of the values: "active", "inactive", "all"');e.status=b.status}j(b.withTags)&&(e.with_tags=b.withTags)}this.__super__.__sendWithCallback(d,e,"collection",c)},s.getOne=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.get_one",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,"collection",c)},s.activate=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.activate";if(!k(b))throw new Error(e+": collectionId must be a number");var f={project_id:a,collection_id:b};j(c)&&(f.force=c),this.__super__.__sendWithCallback(e,f,null,d)},s.deactivate=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.deactivate",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},s.update=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.update",f={project_id:a};f=this.__super__.__addCollectionIdentifier(f,b),j(c)&&(j(c.name)&&(f.name=c.name),j(c.description)&&(f.description=c.description)),this.__super__.__sendWithCallback(e,f,"collection",d)},s.addTag=function(a,c,d,e,f){"function"==typeof arguments[3]&&(f=arguments[3],e=b),this.__super__.__checkProjectId(a);var g="collection.add_tag",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,c),"string"!=typeof d&&("object"!=typeof d||"undefined"==typeof d.length))throw new Error(g+": tags must be passed");var i;if(i="string"==typeof d?d:d.join(","),!/^[\000-\177]*$/.test(i))throw new Error(g+": non ascii characters found in tag name");h.tags=d,j(e)&&(j(e.weight)&&(h.weight=e.weight),j(e.removeOther)&&(h.remove_other=!!e.removeOther)),this.__super__.__sendWithCallback(g,h,null,f)},s.deleteTag=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.delete_tag",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c&&("object"!=typeof c||"undefined"==typeof c.length))throw new Error(e+": tags must be passed");var g;if(g="string"==typeof c?c:c.join(","),!/^[\000-\177]*$/.test(g))throw new Error(e+": non ascii characters found in tag name");f.tags=c,this.__super__.__sendWithCallback(e,f,null,d)},s.authorize=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="collection.authorize",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!k(c))throw new Error(f+": apiClientId must be a number");var h=["create_data","read_data","read_own_data","update_data","update_own_data","delete_data","delete_own_data"];if(-1===h.indexOf(d))throw new Error(f+": unknown permission name ("+d+")");g.api_client_id=c,g.permission=d,this.__super__.__sendWithCallback(f,g,null,e)},s.deauthorize=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="collection.deauthorize",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!k(c))throw new Error(f+": apiClientId must be a number");var h=["create_data","read_data","read_own_data","update_data","update_own_data","delete_data","delete_own_data"];if(-1===h.indexOf(d))throw new Error(f+": unknown permission name ("+d+")");g.api_client_id=c,g.permission=d,this.__super__.__sendWithCallback(f,g,null,e)},s.delete=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.delete",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)};var t={};t.new=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.new",f={name:c,project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),!c)throw new Error("Folder must have a name");this.__super__.__sendWithCallback(e,f,"folder",d)},t.get=function(a,b,c){this.__super__.__checkProjectId(a);var d="folder.get",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,"folder",c)},t.getOne=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.get_one",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c)throw new Error("FolderName must be a string");f.folder_name=c,this.__super__.__sendWithCallback(e,f,"folder",d)},t.update=function(a,b,c,d,e,f){if("object"==typeof arguments[3]){var g=Object.create(arguments[3]);f=arguments[4],d=g.newName,e=g.sourceId}this.__super__.__checkProjectId(a);var h="folder.update",i={project_id:a};if(i=this.__super__.__addCollectionIdentifier(i,b),"string"!=typeof c)throw new Error("FolderName must be a string");if(i.name=c,!j(d))throw new Error("newName must be passed");if("string"!=typeof d)throw new Error("newName must be a string");if(i.new_name=d,j(e)){if(!k(e))throw new Error("sourceId must be a number");i.source_id=e+""}this.__super__.__sendWithCallback(h,i,"folder",f)},t.delete=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.delete",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c)throw new Error("FolderName must be a string");f.name=c,this.__super__.__sendWithCallback(e,f,null,d)},t.authorize=function(a,b,c,d,e,f){this.__super__.__checkProjectId(b);var g="folder.authorize",h={project_id:b};if(h=this.__super__.__addCollectionIdentifier(h,c),h.api_client_id=a,"string"!=typeof e)throw new Error("FolderName must be a string");h.name=e;var i=["create_data","read_data","read_own_data","update_data","update_own_data","delete_data","delete_own_data"];if(!j(d)||-1===i.indexOf(d))throw new Error("Permission must be one of: "+i.join(", "));h.permission=d,this.__super__.__sendWithCallback(g,h,null,f)};var u={};u.new=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.new",f={project_id:a};f=this.__super__.__addCollectionIdentifier(f,b);var g,h;if(j(c)){for(var l=["dataKey","userName","sourceUrl","title","text","link","image","imageUrl","folder","state"],m=0;m<l.length;m++){var n=l[m];if(j(c[n])){if("string"!=typeof c[n])throw new Error(n+" must be a string");f[i(n)]=c[n]}}if(j(c.parentId)){if(!k(c.parentId))throw new Error("parentId must be a number");f.parent_id=c.parentId}if(j(f.state)&&-1===["pending","moderated","rejected"].indexOf(f.state.toLowerCase()))throw new Error("incorrect value of state param");if(j(c.additional))for(g in c.additional)if(c.additional.hasOwnProperty(g)){var o=c.additional[g];if(-1!==l.indexOf(g)||"parent_id"===g)throw new Error("Cannot use additional (custom) param named "+g);f[g]=o}if(j(c.special)&&Object.keys(c.special).length>0){var p=["data1","data2","data3"];for(g in c.special)if(c.special.hasOwnProperty(g)){h=c.special[g];var q=p.indexOf(g);-1!==q&&(f[g]=h,p[q]=null,delete c.special[g])}if(Object.keys(c.special).length>0)for(g in c.special)if(c.special.hasOwnProperty(g)){h=c.special[g];var r;do r=p.shift();while(null===r&&p.length>0);"undefined"!=typeof r&&(f[r]=h,f[g]=r)}}}this.__super__.ignoreNextNew=!0,this.__super__.__sendWithCallback(e,f,"data",d)},u.get=function(a,b,c,d){var e;this.__super__.__checkProjectId(a);var f="data.get",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),j(c)){var h=["dataIds","folders","byUser","parentIds"];for(e=0;e<h.length;e++){var o=h[e];j(c[o])&&(g[i(o)]=c[o])}var p=["maxId","limit","sinceId","depth","childrenLimit"];for(e=0;e<p.length;e++){var q=p[e];if(j(c[q])){if(!k(c[q]))throw new Error(q+" must be a number");g[i(q)]=c[q]}}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");g.state=c.state}if(j(c.sinceTime)){if(!l(c.sinceTime))throw new Error("Param sinceTime must be a proper date string");g.since_time=c.sinceTime}if(j(c.order)){if(-1===["asc","desc"].indexOf(c.order.toLowerCase()))throw new Error('incorrect value of order param - only "asc" and "desc" are allowed');g.order=c.order}if(j(c.orderBy)){if(!m(c.orderBy.toLowerCase(),["created_at","updated_at","data1","data2","data3"]))throw new Error('incorrect value of order_by param - only "created_at" and "updated_at" are allowed');g.order_by=c.orderBy}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');g.filter=c.filter}if(j(c.includeChildren)){if(!n(c.includeChildren))throw new Error("includeChildren param must be boolean");g.include_children=c.includeChildren}for(var r=["data1","data2","data3"],s=["eq","neq","lte","lt","gte","gt"],t=0;t<r.length;t++)for(var u=0;u<s.length;u++){var v=r[t]+"__"+s[u];j(c[v])&&(g[v]=c[v])}}this.__super__.__sendWithCallback(f,g,"data",d)},u.getOne=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.get_one",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"==typeof c)f.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");f.data_id=c}this.__super__.__sendWithCallback(e,f,"data",d)},u.increase=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.update",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),"string"==typeof c)h.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");h.data_id=c}var i=["data1","data2","data3"];-1!==i.indexOf(d)&&(h[d+"__inc"]=e),this.__super__.ignoreNextChange=!0,this.__super__.__sendWithCallback(g,h,"data",f)},u.decrease=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.update",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),"string"==typeof c)h.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");h.data_id=c}var i=["data1","data2","data3"];-1!==i.indexOf(d)&&(h[d+"__dec"]=e),this.__super__.ignoreNextChange=!0,this.__super__.__sendWithCallback(g,h,"data",f)},u.update=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.update",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),"string"==typeof c)g.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");g.data_id=c}if(j(d)){for(var h=["updateMethod","userName","sourceUrl","title","text","link","image","imageUrl","dataKey","data1","data2","data3"],l=0;l<h.length;l++){var n=h[l];if(j(d[n])){var o=n;"data1"!==n&&"data2"!==n&&"data3"!==n&&(o=i(n)),g[o]=d[n]}}if(j(d.parentId)){if(!k(d.parentId))throw new Error("parentId must be a number");g.parent_id=d.parentId}if(j(d.state)){if(!m(d.state.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of state param");g.state=d.state}}if(j(d.additional))for(var p in d.additional)if(d.additional.hasOwnProperty(p)){var q=d.additional[p];if("undefined"!=typeof g[p])throw new Error("Cannot use additional (custom) param named "+p);g[p]=q}this.__super__.ignoreNextChange=!0,this.__super__.__sendWithCallback(f,g,"data",e)},u.move=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.move",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["dataIds","folders","byUser","newFolder"],h=0;h<g.length;h++){var l=g[h];j(c[l])&&(f[i(l)]=c[l])}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.newState)){if(!m(c.newState.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of newState param");f.new_state=c.newState}if(j(c.limit)){if(!k(c.limit))throw new Error("limit must be a number");f.limit=c.limit}}this.__super__.ignoreNextChange=!0,this.__super__.__sendWithCallback(e,f,null,d)},u.copy=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.copy",f={project_id:a,data_ids:[]};if(f=this.__super__.__addCollectionIdentifier(f,b),!j(c))throw new Error("dataId must be set");if(k(c))f.data_ids=[String(c)];else{if("object"!=typeof c)throw new Error("dataId must be integer or array of integers");f.data_ids=[];for(var g=0;g<c.length;g++){if(!k(c[g]))throw new Error("dataId must be integer or array of integers");f.data_ids.push(String(c[g]))}}this.__super__.__sendWithCallback(e,f,"data",d)},u.addParent=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.add_parent",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),!j(c)||!k(c))throw new Error("dataId must be passed");if(h.data_id=c,!j(d)||!k(d))throw new Error("parentId must be passed");h.parent_id=d,j(e)&&n(e)&&(h.remove_other=e),this.__super__.ignoreNextNewRelation=!0,this.__super__.__sendWithCallback(g,h,null,f)},u.removeParent=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.remove_parent",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!j(c)||!k(c))throw new Error("dataId must be passed");g.data_id=c,j(d)&&k(d)&&(g.parent_id=d),this.__super__.ignoreNextDeleteRelation=!0,this.__super__.__sendWithCallback(f,g,null,e)},u.addChild=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.add_child",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),!j(c)||!k(c))throw new Error("dataId must be passed");if(h.data_id=c,!j(d)||!k(d))throw new Error("childId must be passed");h.child_id=d,j(e)&&n(e)&&(h.remove_other=e),this.__super__.ignoreNextNewRelation=!0,this.__super__.__sendWithCallback(g,h,null,f)},u.removeChild=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.remove_child",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!j(c)||!k(c))throw new Error("dataId must be passed");g.data_id=c,j(d)&&k(d)&&(g.child_id=d),this.__super__.ignoreNextDeleteRelation=!0,this.__super__.__sendWithCallback(f,g,null,e)},u.delete=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.delete",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["dataIds","folders","byUser"],h=0;h<g.length;h++){var l=g[h];j(c[l])&&(f[i(l)]=c[l])}if(j(c.limit)){if(!k(c.limit))throw new Error("limit must be a number");f.limit=c.limit}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.ignoreNextDelete=!0,this.__super__.__sendWithCallback(e,f,null,d)},u.count=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.count",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["folders","byUser"],h=0;h<g.length;h++){var k=g[h];j(c[k])&&(f[i(k)]=c[k])}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,"count",d)};var v={};v.__internalDataGet=function(a,b,c,d,e,f){this.__super__.Data.get(c,d,e,function(g){var h=g.length;a=a.concat(g),0===h||h!==b?f(a):(e.sinceId=parseInt(g[h-1].id,10),this.__internalDataGet(a,b,c,d,e,f))}.bind(this))},v.get=function(a,b,c,d){var e=[],f=100;"undefined"!=typeof c.limit&&(f=c.limit),this.__internalDataGet(e,f,a,b,c,function(a){d(a)})};var w={};w.__internalReadLevel=function(a,b,c,d,e){this.__super__.BigData.get(a,b,c,function(f){for(var g=f.length,h=[],i=0;g>i;i++){var j=f[i],k=0|j.id;d.push(k),j.children_count>0&&h.push(k)}h.length>0?(c.parentIds=h,this.__internalReadLevel(a,b,c,d,e)):e(d)}.bind(this))},w.__internalRemoveIds=function(a,b,c,d,e){var f=100,g=c.splice(0,f),h={dataIds:g,folders:d};this.__super__.Data.delete(a,b,h,function(){0===c.length?e():this.__internalRemoveIds(a,b,c,d,e)}.bind(this))},w.delete=function(a,b,c,d,e){var f={parentIds:c,folders:d,includeChildren:!1},g=[c];this.__internalReadLevel(a,b,f,g,function(c){this.__internalRemoveIds(a,b,c,d,e)}.bind(this))},w.get=function(a,b,c,d){var e={folders:c,includeChildren:!1},f=[],g=[],h={},i=function(){console.log("Przetwarzam, liczba węzłów:",g.length);var c=g.shift();h[c]=[];var e={includeChildren:!1,parentIds:c};this.__super__.BigData.get(a,b,e,function(a){for(var b=0;b<a.length;b++){var e=a[b];e.id=0|e.id,h[c].push(e.id),f.push(e),e.children_count>0&&g.push(e.id)}0===g.length?d(f,h):i()}.bind(this))}.bind(this);this.__super__.BigData.get(a,b,e,function(a){for(var b=0;b<a.length;b++){var c=a[b];c.id=0|c.id,f.push(c),c.children_count>0&&g.push(c.id)}i()})};var x={};x.login=function(a,b,e,g,h){var i="user.login",k={};if("object"===c(a)&&(d(b)||f(b))){var l=a;h=b,g=l.api_key,a=l.user_name,b=l.password,e=l.instance}if(!j(a))throw new Error("Please provide user name");if(k.user_name=a,!j(b))throw new Error("Please provide password");k.password=b,j(e)&&(k.instance=e),j(g)&&(k.apiKey=g);var m=function(){},n=function(a){this.__super__.trigger("syncano:error",a)}.bind(this);"function"==typeof h?m=h:"object"==typeof h&&("function"==typeof h.success&&(m=h.success),"function"==typeof h.error&&(n=h.error)),this.__super__.__sendAjaxRequest(i,k,"user",function(a){"undefined"!=typeof a.auth_key&&"OK"===a.result?(this.auth_key=a.auth_key,m(a)):"NOK"===a.result?n(a.error):m(a)}.bind(this.__super__))},x.new=function(a,b,c){var d="user.new",e={};if(!j(a))throw new Error("user must have a name");e.user_name=a,j(b)&&(e.nick=b),this.__super__.__sendWithCallback(d,e,"user",c)},x.getAll=function(a,c,d){var e="user.get_all";"function"==typeof arguments[0]&&(d=arguments[0],a=b,c=b);var f={};if(j(a)){if(!k(a))throw new Error("sinceId must be a number");f.since_id=a}if(j(c)){if(!k(c))throw new Error("limit must be a number");f.limit=c}this.__super__.__sendWithCallback(e,f,"user",d)},x.get=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="user.get",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){if(j(c.folders)&&(f.folders=c.folders),j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,"user",d)},x.getOne=function(a,b){var c="user.get_one",d={};if(!j(a))throw new Error("user id or name must be passed");if("number"==typeof a)d.user_id=a;else{if("string"!=typeof a)throw new Error("incorrect type of user param");d.user_name=a}this.__super__.__sendWithCallback(c,d,"user",b)},x.update=function(a,b,c){var d="user.update",e={};if(!j(a))throw new Error("user id or name must be passed");if("number"==typeof a)e.user_id=a;else{if("string"!=typeof a)throw new Error("incorrect type of user param");e.user_name=a}if(j(b)){if("string"!=typeof b)throw new Error("nick must be given");e.nick=b}this.__super__.__sendWithCallback(d,e,"user",c)},x.count=function(a,c){var d="user.count",e={};if(1===arguments.length&&(c=arguments[0],a=b),j(a)){if(j(a.projectId)&&k(a.projectId)&&(e.project_id=a.projectId),j(a.collection))if("string"==typeof a.collection)e.collection_key=a.collection;else{if("number"!=typeof a.collection)throw new Error("collection identifier must be a string (key) or number (id)");e.collection_id=a.collection}if(j(a.folders)&&(e.folders=a.folders),j(a.state)){if(!m(a.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");e.state=a.state}if(j(a.filter)){if(!m(a.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');e.filter=a.filter}}this.__super__.__sendWithCallback(d,e,"count",c)},x.delete=function(a,b){var c="user.delete",d={};if("number"==typeof a)d.user_id=a;else{if("string"!=typeof a)throw new Error("user identifier must be given");d.user_name=a}this.__super__.__sendWithCallback(c,d,null,b)};var y={};y.subscribeProject=function(a,b){var c="subscription.subscribe_project";if(!j(a)||!k(a))throw new Error("projectId must be defined");this.__super__.__sendWithCallback(c,{project_id:a},null,b)},y.unsubscribeProject=function(a,b){var c="subscription.unsubscribe_project";if(!j(a)||!k(a))throw new Error("projectId must be defined");this.__super__.__sendWithCallback(c,{project_id:a},null,b)},y.subscribeCollection=function(a,b,c){this.__super__.__checkProjectId(a);var d="subscription.subscribe_collection",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},y.unsubscribeCollection=function(a,b,c){this.__super__.__checkProjectId(a);var d="subscription.unsubscribe_collection",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},y.get=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="subscription.get",e={};j(a)&&(e.api_client_id=a),this.__super__.__sendWithCallback(d,e,"subscription",c)};var z={};z.get=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="connection.get",e={};if(j(a)){for(var f=["apiClientId","sinceId","limit"],g=0;g<f.length;g++){var h=f[g];if(j(a[h])){if(!k(a[h]))throw new Error(d+": "+h+" must be a number");e[i(h)]=a[h]}}if(j(a.name)){if("string"!=typeof a.name)throw new Error(d+": name must be a string");e.name=a.name}}this.__super__.__sendWithCallback(d,e,"connection",c)},z.update=function(a,c,d){"function"==typeof arguments[1]&&(d=arguments[1],c=b);var e="connection.update",f={};if(!j(a)||"string"!=typeof a)throw new Error(e+": uuid parameter is required");if(f.uuid=a,j(c)){if(j(c.apiClientId)){if(!k(c.apiClientId))throw new Error(e+": apiClientId must be a number");f.api_client_id=c.apiClientId}if(j(c.name)){if("string"!=typeof c.name)throw new Error(e+": name must be a string");f.name=c.name}if(j(c.state)){if("string"!=typeof c.state)throw new Error(e+": state must be a string");f.state=c.state}}this.__super__.__sendWithCallback(e,f,"connection",d)};var A={};A.send=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="notification.send",e={};if(j(a)){if(j(a.apiClientId)){if(!k(a.apiClientId))throw new Error(d+": apiClientId must be a number");e.api_client_id=a.apiClientId}if(j(a.uuid)){if("string"!=typeof a.uuid)throw new Error(d+": uuid must be a string");e.uuid=a.uuid}if(j(a.data))for(var f in a.data)if(a.data.hasOwnProperty(f)){var g=a.data[f];if(m(f,["apiClientId","api_client_id","uuid"]))throw new Error(d+": Cannot send custom param named "+f);e[f]=g}}this.__super__.__sendWithCallback(d,e,null,c)},A.getHistory=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="notification.get_history",e={};if(j(a)){if(j(a.apiClientId)){if(!k(a.apiClientId))throw new Error(d+": apiClientId must be a number");e.api_client_id=a.apiClientId}for(var f=["limit","sinceId"],g=0;g<f.length;g++){var h=f[g];if(j(a[h])){if(!k(a[h]))throw new Error(d+": "+h+" must be a number");e[i(h)]=a[h]}}if(j(a.sinceTime)){if(!l(a.sinceTime))throw new Error(d+": sinceTime must be a proper date string");e.since_time=a.sinceTime}if(j(a.order)){if("undefined"==typeof a.order.toLowerCase||!m(a.order.toLowerCase(),["asc","desc"]))throw new Error(d+': incorrect value of order param - only "asc" and "desc" are allowed');e.order=a.order}}this.__super__.__sendWithCallback(d,e,"history",c)};var B={DISCONNECTED:1,CONNECTED:2,AUTHORIZED:3},C=function(){this.socketURL="https://api.syncano.com/ws",this.socket=null,this.status=B.DISCONNECTED,this.requestId=1,this.uuid=null,this.instance=null,this.apiKey=null,this.requestInProgress=!1,this.ignoreNextNew=!1,this.ignoreNextNewRelation=!1,this.ignoreNextDelete=!1,this.ignoreNextDeleteRelation=!1,this.ignoreNextChange=!1,this.VERSION="3.1.0beta",this.requestsQueue=[],this.connectionType="socket",this.waitingForResponse={},this.Project=r,this.Project.__super__=this,this.Collection=s,this.Collection.__super__=this,this.Folder=t,this.Folder.__super__=this,this.Data=u,this.Data.__super__=this,this.BigData=v,this.BigData.__super__=this,this.Tree=w,this.Tree.__super__=this,this.User=x,this.User.__super__=this,this.Subscription=y,this.Subscription.__super__=this,this.Connection=z,this.Connection.__super__=this,this.Notification=A,this.Notification.__super__=this};C.prototype=h(C.prototype,o),C.prototype.connect=function(b,c){if("undefined"==typeof b||"undefined"==typeof b.api_key||"undefined"==typeof b.instance)throw new Error("syncano.connect requires instance name and api_key");return this.instance=b.instance,this.apiKey=b.api_key,"undefined"==typeof a.Syncano_SockJS&&(this.connectionType="ajax"),"undefined"!=typeof b.type&&(this.connectionType=b.type),this.connectionParams=b,this.auth_key&&(this.connectionParams.auth_key=this.auth_key),this.status!==B.DISCONNECTED?void(this.reconnectOnSocketClose=!0):("undefined"!=typeof c&&(this.waitingForResponse.auth=["auth",c]),void("socket"===this.connectionType?(this.socket=new a.Syncano_SockJS(this.socketURL),this.socket.onopen=this.onSocketOpen.bind(this),this.socket.onclose=this.onSocketClose.bind(this),this.socket.onmessage=this.onMessage.bind(this)):"function"==typeof c&&c()))},C.prototype.onSocketOpen=function(){this.status=B.CONNECTED,this.socketSend(this.connectionParams)},C.prototype.onSocketClose=function(){this.status=B.DISCONNECTED,this.socket=null,this.reconnectOnSocketClose===!0&&(this.reconnectOnSocketClose=!1,this.connect(this.connectionParams))},C.prototype.onMessage=function(a){var b=JSON.parse(a.data);if("NOK"===b.result){var c="auth"===b.type?"auth":b.message_id,d=b.error||b.data.error;return"undefined"!=typeof c&&"undefined"!=typeof this.waitingForResponse[c]&&"object"==typeof this.waitingForResponse[c][1]&&"function"==typeof this.waitingForResponse[c][1].error?this.waitingForResponse[c][1].error(d):this.trigger("syncano:error",d),void("auth"===b.type?(this.socket.close(),this.trigger("syncano:auth:error")):(this.requestInProgress=!1,this.sendQueue()))}switch(b.type){case"auth":this.parseAuthorizationResponse(b);break;case"callresponse":this.status===B.AUTHORIZED&&(this.requestInProgress=!1,this.sendQueue()),this.parseCallResponse(b);break;case"message":this.parseMessageNotifier(b);break;case"new":"data"===b.object?this.parseNewRecordNotifier(b):"datarelation"===b.object&&this.parseNewRelationNotifier(b);break;case"change":this.parseChangeRecordNotifier(b);break;case"delete":"data"===b.object?this.parseDeleteRecordNotifier(b):this.parseDeleteRelationNotifier(b)}},C.prototype.parseAuthorizationResponse=function(a){this.uuid=a.uuid,this.status=B.AUTHORIZED,this.trigger("syncano:received",a),this.trigger("syncano:authorized",this.uuid),this.parseCallResponse({message_id:"auth",data:a}),this.sendQueue()},C.prototype.parseNewRecordNotifier=function(a){if(this.ignoreNextNew===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextNew=!1);this.trigger("syncano:received",a);var b=0|a.channel.project_id,c=0|a.channel.collection_id,d=a.data,e=d.folder;e&&this.trigger("syncano:newdata:folder-"+e,d),this.trigger("syncano:newdata:project-"+b,d),this.trigger("syncano:newdata:collection-"+c,d)},C.prototype.parseNewRelationNotifier=function(a){if(this.ignoreNextNewRelation===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextNewRelation=!1);if(this.trigger("syncano:received",a),"undefined"!=typeof a.target){var b=a.target.parent_id,c=a.target.child_id;this.trigger("syncano:newparent:data-"+c,b),this.trigger("syncano:newchild:data-"+b,c)}},C.prototype.parseChangeRecordNotifier=function(a){if(this.ignoreNextChange===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextChange=!1);var b=a.target.id;this.trigger("syncano:received",a);for(var c=0;c<b.length;c++){var d=b[c],e={};"undefined"!=typeof a.add&&(e.add=a.add),"undefined"!=typeof a.replace&&(e.replace=a.replace),"undefined"!=typeof a.delete&&(e["delete"]=a["delete"]),this.trigger("syncano:change:data-"+d,e)}},C.prototype.parseDeleteRecordNotifier=function(a){if(this.ignoreNextDelete===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextDelete=!1);
var b=a.target.id;this.trigger("syncano:received",a);for(var c=0;c<b.length;c++){var d=b[c];this.trigger("syncano:delete:data-"+d)}},C.prototype.parseDeleteRelationNotifier=function(a){if(this.ignoreNextDeleteRelation===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextDeleteRelation=!1);if(this.trigger("syncano:received",a),"undefined"!=typeof a.target){var b=a.target.parent_id,c=a.target.child_id;this.trigger("syncano:removeparent:data-"+c,b),this.trigger("syncano:removechild:data-"+b,c)}},C.prototype.parseMessageNotifier=function(a){this.trigger("syncano:received",a),this.trigger("syncano:message",a)},C.prototype.parseCallResponse=function(a){var b=a.message_id;if("undefined"!=typeof b&&"undefined"!=typeof this.waitingForResponse[b]){var c=this.waitingForResponse[b],d=c[0].replace(".",":"),e=c[1];this.trigger("syncano:received",a),this.trigger("syncano:"+d,a.data),"function"==typeof e?e(a.data):"object"==typeof e&&"function"==typeof e.success&&e.success(a.data),delete this.waitingForResponse[b]}else this.trigger("syncano:ignored",a)},C.prototype.sendQueue=function(){if(this.requestsQueue.length>0){var a=this.requestsQueue.shift();this.socketSend(a)}},C.prototype.getNextRequestId=function(){return this.requestId++},C.prototype.socketSend=function(a){this.socket.send(JSON.stringify(a)+"\n")},C.prototype.sendRequest=function(a,b,c,d){if("undefined"==typeof b&&(b={}),"ajax"===this.connectionType||"ajax"===d){var e="https://"+this.instance+".syncano.com/api/"+a+"?api_key="+this.apiKey+"&";for(var f in b)b.hasOwnProperty(f)&&(e+=f+"="+b[f]+"&");var g=new XMLHttpRequest;g.open("GET",e,!0),g.onreadystatechange=function(){if(4===g.readyState&&200===g.status){var a=JSON.parse(g.responseText);this.trigger("syncano:received",a),c(a)}}.bind(this),g.send()}else if("socket"===this.connectionType){var h={type:"call",method:a,params:b};h.message_id=this.getNextRequestId(),this.waitingForResponse[h.message_id]=[a,c],this.status===B.AUTHORIZED&&this.requestInProgress===!1?(this.requestInProgress=!0,this.trigger("syncano:call",h),this.socketSend(h)):(this.trigger("syncano:queued",h),this.requestsQueue.push(h))}},C.prototype.__checkProjectId=function(a){if("number"!=typeof a)throw new Error("projectId must be a number")},C.prototype.__addCollectionIdentifier=function(a,b){if("number"==typeof b)a.collection_id=b;else{if("string"!=typeof b)throw new Error("Collection key/id must be passed");a.collection_key=b}return a},C.prototype.__sendWithCallback=function(a,b,c,d,e){var f,g=function(){};"function"==typeof d?g=d:"object"==typeof d&&("function"==typeof d.success&&(g=d.success),"function"==typeof d.error&&(f=d.error));var h=function(a){var b;b=null===c?!0:"undefined"!=typeof a[c]?a[c]:a,g(b)};this.sendRequest(a,b,{success:h,error:f},e)},C.prototype.__sendAjaxRequest=function(a,b,c,d){if("undefined"==typeof b&&(b={}),null===this.instance){if("undefined"==typeof b.instance)throw new Error("Please provide instance name");this.instance=b.instance,delete b.instance}if(null===this.apiKey){if("undefined"==typeof b.apiKey)throw new Error("Please provide api key");this.apiKey=b.apiKey,delete b.apiKey}var e="https://"+this.instance+".syncano.com/api/"+a+"?api_key="+this.apiKey+"&";for(var f in b)b.hasOwnProperty(f)&&(e+=f+"="+b[f]+"&");var g=new XMLHttpRequest;g.open("GET",e,!0),g.onreadystatechange=function(){if(4===g.readyState&&200===g.status){var a,b=JSON.parse(g.responseText);a="undefined"!=typeof b[c]?b[c]:b,this.trigger("syncano:received",b),d(a)}}.bind(this),g.send()};var D=null;a.SyncanoConnector={getInstance:function(){return null===D&&(D=new C),D}}}(this);
